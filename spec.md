## General Specs for Manga Viewer

Insight into how each component works together to allow for seamless manga reading. May be helpful if anyone else is looking into the MangaDex API and doesn't know where to begin (or is lost on something).

### <i class="icon w-24" data-feather="link-2"></i> Useful links

- [MangaDex](https://mangadex.org/)
- [MangaDex API](https://api.mangadex.org/swagger)
- [MangaDex Discord](https://discord.gg/mangadex)

### <i class="icon w-24" data-feather="lock"></i> Authentication

> Related: [auth.js](/js/auth.js), [check_auth.js](/js/check_auth.js)

Most of the more advanced features (and general usability features) are locked behind Authentication, which is done via MangaDex. Therefore, a MangaDex account is required.

To authenticate, head over to [the authentication page](/auth.html) and enter in your MangaDex credentials (email & password). Once you submit your credentials, they are sent via the API to https://api.mangadex.org/auth/login. The API will then send back a session token and a refresh token.

This refresh token can then be periodically used every **14 min** to refresh your current session via https://api.mangadex.org/auth/refresh.

Your current session can be viewed in the [settings page](/settings), using https://api.mangadex.org/user/me to get your current user information.

### <i class="icon w-24" data-feather="book"></i> Reading

> Related: [read.js](/js/read.js)

Reading manga is done via the MangaDex@Home network, using https://api.mangadex.org/at-home/server/${chapterid} to start. From there, a chapter hash, a base URL, and a data-type is retrieved and allows for a re-construction of the URL. Each URL is generated by MangaDex for your individual session, and cannot be sent to others after a set amount of time.

eg. https://abcdefg.hijklmn.mangadex.network:12345/some-token/data/e199c7d73af7a58e8a4d0263f03db660/x1-b765e86d5ecbc932cf3f517a8604f6ac6d8a7f379b0277a117dc7c09c53d041e.png (as per documentation)

The current manga and chapter is done via URL parameters (or queries), specified below:

- `?m=74088ca4-48ea-4c09-8df0-2943708b1c0c` The manga's ID.
- `?c=e81d4141-c28a-409c-9c60-3e2b4fba9a9e` The manga's chapter ID.

eg. read.html?c=e81d4141-c28a-409c-9c60-3e2b4fba9a9e&m=74088ca4-48ea-4c09-8df0-2943708b1c0c

MangaDex allows for a data-quality to be specified, either `data` (highest), or `data-saver` (lower quality). This can be changed in the [settings](/settings), listed under "Prefer low quality downloads" (enabling will opt for data-saver).

### <i class="icon w-24" data-feather="eye"></i> Viewing

> Related: [view.js](/js/view.js), [chapter.js](/js/chapter.js)

Manga pages can be retrieved using a manga's ID. This is usually found using the search but can be entered directly if you so choose. A request is then sent to the MangaDex API using https://api.mangadex.org/manga/${manga}?includes[]=author&includes[]=artist&includes[]=cover_art&includes[]=manga

`?includes[]=` is used to expand the results, preventing the need for multiple API requests for a single manga. Also, making the development a lot easier to control.

As an example, view.html?m=74088ca4-48ea-4c09-8df0-2943708b1c0c brings you to *Gabriel DropOut*'s page. The same link can be found by searching "gabriel dropout".

If a manga ID is invalid, a 404 page will be displayed instead.

#### Attributes

A manga's attributes are defined as general tags, links, published state, titles, descriptions, and everything else you would expect. The information can be extracted as needed from a single request, without the requirement of `?includes[]=`.

This information (eg. title, description) is inserted directly into the DOM, whereas tags are all generated in js and then inserted into the DOM.

#### Relationships

A manga's 'relationships' are defined as related manga, cover art, and the author/artist of a given manga.

The cover art of a manga can be retrieved using the mentioned `?includes[]=cover_art` to directly expose the manga's cover art URL. This can then be constructed as follows: https://uploads.mangadex.org/covers/${manga}/${relationships[i].attributes.fileName}

With the `fileName` being directly in the result.

### <i class="icon w-24" data-feather="search"></i> Searching

> Related: [search.js](/js/search.js), [search_box.js](/js/search_box.js)

Search is done directly in conjuction with the MangaDex API, sending a request based on a user's input. You can access the search from any page, located in the header.

As an example, if a user searches "foo", a request will be sent to https://api.mangadex.org/manga?title=foo

Interestingly, searching with spaces searches each word on it's own (likely using OR logic instead of AND), so if a user searches "foo bar", while the request will be sent as https://api.mangadex.org/manga?title=foo%20bar,  each word will be treated seperately.

> Currently, age ratings do not take affect in the settings, but they will be passed using the same URL.
